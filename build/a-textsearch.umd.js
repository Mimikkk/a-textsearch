(function(y,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(y=typeof globalThis<"u"?globalThis:y||self,b(y["a-textsearch"]={}))})(this,function(y){"use strict";var b;(f=>{f.create=(c,r)=>{r.sensitive||(c=c.toLowerCase());const s=t.create(c);return e=>{if(r.sensitive||(e=e.toLowerCase()),c===e)return{isMatch:!0,score:0,indices:[[0,e.length-1]]};const n=[];let a=0;for(const i of s){const h=o(e,i,r);a+=h.score,h.isMatch&&n.push(...h.indices)}return a/=s.length,n.length?{isMatch:!0,score:a,indices:n}:{isMatch:!1,score:void 0,indices:void 0}}};const u=(c,r,s,e,n)=>{const a=r/c.length,i=Math.abs(e-s);return n?a+i/n:i?1:a},M=(c,r)=>{const s=[];let e=-1,n=-1,a=0;for(let i=c.length;a<i;++a){const h=c[a];h&&e===-1?e=a:!h&&e!==-1&&(n=a-1,n-e+1>=r&&s.push([e,n]),e=-1)}return c[a-1]&&a-e>=r&&s.push([e,a-1]),s},o=(c,{text:r,mask:s},{distance:e,threshold:n,minMatch:a})=>{const i=r.length,h=c.length,d=Math.max(0,Math.min(0,h));let g=n,v=d;const C=Array(h);let k;for(;(k=c.indexOf(r,v))>-1;){const S=u(r,0,k,d,e);g=Math.min(S,g),v=k+i;let w=0;for(;w<i;)C[k+w]=1,++w}v=-1;let A=[],B=1,T=i+h;const G=1<<i-1;for(let S=0;S<i;++S){let w=0,x=T;for(;w<x;)u(r,S,d+x,d,e)<=g?w=x:T=x,x=Math.floor((T-w)/2+w);T=x;let K=Math.max(1,d-x+1),R=Math.min(d+x,h)+i,z=Array(R+2);z[R+1]=(1<<S)-1;for(let m=R;m>=K;m-=1){let j=m-1,P=s.get(c[j]);if(C[j]=+!!P,z[m]=(z[m+1]<<1|1)&P,S&&(z[m]|=(A[m+1]|A[m])<<1|1|A[m+1]),z[m]&G&&(B=u(r,S,j,d,e),B<=g)){if(g=B,v=j,v<=d)break;K=Math.max(1,2*d-v)}}if(u(r,S+1,d,d,e)>g)break;A=z}const I=Math.max(.001,B);return v>=0?{isMatch:!0,score:I,indices:M(C,a)}:{isMatch:!1,score:I,indices:void 0}};let l;(c=>{c.create=r=>{const s=new Map;for(let e=0,n=r.length;e<n;++e){const a=r[e];s.set(a,(s.get(a)??0)|1<<n-e-1)}return s}})(l||(l={}));let t;(c=>{const r=(e,n)=>({text:e,mask:l.create(e),startIndex:n});c.create=e=>{const n=[],a=e.length;if(a>32){let i=0;const h=a%32,d=a-h;for(;i<d;)n.push(r(e.substring(i,32),i)),i+=32;if(h){const g=a-32;n.push(r(e.substring(g),g))}}else a>0&&n.push(r(e,0));return n}})(t||(t={}))})(b||(b={}));const Q=f=>{let u=0;for(let M=0,o=f.length;M<o;++M)f[M]!==" "&&++u;return u},E=f=>Math.round(1/Math.sqrt(Q(f))*1e3)/1e3,V=f=>typeof f[0]=="string",D=f=>f!==null;var p;(f=>{f.find=(r,s)=>s.flatMap(e=>u(e,r)).filter(D);const u=(r,s)=>"norm"in r?M(r,s):o(r,s),M=({item:r,index:s,norm:e},n)=>{const{isMatch:a,score:i,indices:h}=n(r);return a?{item:r,index:s,matches:[{score:i,item:r,norm:e,indices:h}],depth:0,score:Math.pow(i,e)}:null},o=(r,s)=>{const e=i=>{var h;return[i,...((h=i.children)==null?void 0:h.flatMap(d=>e(d)))??[]]},n=[],a=e(r);for(const i of a){const h=l(i,s);if(!h.length)continue;const{item:d,index:g,depth:v}=i,C=h.reduce((k,{key:A,norm:B,score:T})=>k*Math.pow(T,A.weight*B),1);n.push({item:d,index:g,matches:h,score:C,depth:v})}return n},l=({entries:r},s)=>{const e=[];for(const[n,a]of r)if(Array.isArray(a))for(const i of a){const h=c(i,n,s);h&&e.push(h)}else{const i=t(a,n,s);i&&e.push(i)}return e},t=({item:r,norm:s},e,n)=>{const{isMatch:a,score:i,indices:h}=n(r);return a?{score:i,key:e,item:r,norm:s,indices:h}:null},c=({item:r,norm:s,index:e},n,a)=>{const{isMatch:i,score:h,indices:d}=a(r);return i?{score:h,key:n,index:e,item:r,norm:s,indices:d}:null}})(p||(p={}));var L;(f=>{f.get=(u,M)=>{try{const o=M.split(".");let l=u;for(let t=0,c=o.length;t<c;++t)l=l[o[t]];return l}catch{return}},f.set=(u,M,o)=>{const l=M.split(".");let t=u;for(let c=0,r=l.length-1;c<r;++c){const s=l[c];s in t||(t[s]={}),t=t[s]}return t[l[l.length-1]]=o,u}})(L||(L={}));var O;(f=>{f.create=(t,c)=>V(t)?t.map(M.create):t.map((r,s)=>o.create(r,s,c,0));let u;(t=>{t.create=c=>({item:c,norm:E(c)})})(u||(u={}));let M;(t=>{t.create=(c,r)=>({item:c,index:r,norm:E(c)}),t.array=c=>{const r=[],s=[[c,0]];for(;s.length;){const[e,n]=s.pop();typeof e=="string"?r.unshift(t.create(e,n)):s.push(...e.map((a,i)=>[a,i]))}return r}})(M||(M={}));let o;(t=>{t.create=(c,r,s,e)=>{const n=L.get(c,s.recursiveBy);return{item:c,index:r,depth:e,entries:l.create(c,s.keys),children:n==null?void 0:n.map((a,i)=>(0,t.create)(a,i,s,e+1))}}})(o||(o={}));let l;(t=>{t.create=(c,r)=>r.map(s=>{const e=L.get(c,s.path),n=Array.isArray(e)?M.array(e):u.create(e);return[s,n]})})(l||(l={}))})(O||(O={})),y.TextSearch=void 0,(f=>{f.create=(o,l)=>{const t=u.from(l),c=O.create(o,t);return(r,s)=>{const e=p.find(b.create(r,t),c);return t.sortBy&&e.sort(t.sortBy),s&&(e.length=Math.min(e.length,s)),e}};let u;(o=>{o.from=t=>{var c;return{recursiveBy:t==null?void 0:t.recursiveBy,sensitive:(t==null?void 0:t.sensitive)??!1,threshold:(t==null?void 0:t.threshold)??.6,distance:(t==null?void 0:t.distance)??100,minMatch:(t==null?void 0:t.minMatch)??1,sortBy:(t==null?void 0:t.sortBy)??M,keys:((c=t==null?void 0:t.keys)==null?void 0:c.map(l.from))??[]}};let l;(t=>{t.from=c=>typeof c=="string"?{path:c,weight:1}:{path:c.path,weight:c.weight??1}})(l||(l={}))})(u=f.Configuration||(f.Configuration={}));const M=(o,l)=>o.score===l.score?o.index-l.index:o.score-l.score})(y.TextSearch||(y.TextSearch={}));const F=y.TextSearch.create;y.create=F,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
